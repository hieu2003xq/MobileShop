
@{
    Page.Title = "Giỏ Hàng";
    Layout = "~/Views/Shared/_Layout2.cshtml";
}

<!-- Content Header (Page header) -->
<!-- Main content -->
<div class="product-big-title-area">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="product-bit-title text-center">
                    <h2>Shopping Cart</h2>
                </div>
            </div>
        </div>
    </div>
</div> <!-- End Page title area -->


<div class="single-product-area">
    <div class="zigzag-bottom"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <div class="single-sidebar">
                    <h2 class="sidebar-title">Tìm kiếm</h2>
                    <form action="">
                        <input type="text" id="check" placeholder="Tìm kiếm">
                        <div class="single-sidebar" id="load_payment" style="display:none;">

                        </div>
                        <input type="submit" id="gui1" value="Tìm">
                    </form>
                </div>

                <div class="single-sidebar">
                    <h2 class="sidebar-title">Products</h2>
                   <div id="sP1"></div>
                </div>

              
            </div>

            <div class="col-md-8">
                <div class="product-content-right">
                    <div class="woocommerce">
                        <form method="post" action="#">
                            @Html.AntiForgeryToken()
                            <table cellspacing="0" class="shop_table cart">
                                <thead>
                                    <tr>
                                    <tr>
                                        <th>Hình ảnh</th>
                                        <th>Tên sản phẩm</th>
                                        <th>Giá bán</th>
                                        <th>Số lượng</th>
                                        <th>Giảm giá</th>
                                        <th style="text-align:center">Tổng tiền</th>
                                        <th>Chức năng</th>
                                    </tr>
                                </thead>
                                <tbody id="muaHang1">
                                </tbody>
                            </table>
                        </form>
                        <div>
                            <a href="@Url.Action("Index","sanPham")" class="btn btn-info"><i class="fa fa-arrow-left"></i> Quay lại mua hàng</a>
                            <button class="btn btn-success pull-right" id="dat1"><i class="fa fa fa-shopping-cart"></i> Đặt hàng</button>
                        </div>

                        <div class="cart-collaterals">
                            <div class="cart_totals ">
                                <h2>Thông Tin Đơn</h2>

                                <table cellspacing="0">
                                    <tbody>
                                        <tr class="shipping">
                                            <th>Hình thức</th>
                                            <td>Free Shipping</td>
                                        </tr>

                                        <tr class="order-total">
                                            <th >Tổng tiền</th>
                                            <td><strong><span class="amount" id="thanhTien1"></span></strong></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="footer-top-area">
    <div class="zigzag-bottom"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-3 col-sm-6">
                <div class="footer-about-us">
                    <h2>u<span>Stora</span></h2>
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Perferendis sunt id doloribus vero quam laborum quas alias dolores blanditiis iusto consequatur, modi aliquid eveniet eligendi iure eaque ipsam iste, pariatur omnis sint! Suscipit, debitis, quisquam. Laborum commodi veritatis magni at?</p>
                    <div class="footer-social">
                        <a href="#" target="_blank"><i class="fa fa-facebook"></i></a>
                        <a href="#" target="_blank"><i class="fa fa-twitter"></i></a>
                        <a href="#" target="_blank"><i class="fa fa-youtube"></i></a>
                        <a href="#" target="_blank"><i class="fa fa-linkedin"></i></a>
                    </div>
                </div>
            </div>

            <div class="col-md-3 col-sm-6">
                <div class="footer-menu">
                    <h2 class="footer-wid-title">User Navigation </h2>
                    <ul>
                        <li><a href="#">My account</a></li>
                        <li><a href="#">Order history</a></li>
                        <li><a href="#">Wishlist</a></li>
                        <li><a href="#">Vendor contact</a></li>
                        <li><a href="#">Front page</a></li>
                    </ul>
                </div>
            </div>

            <div class="col-md-3 col-sm-6">
                <div class="footer-menu">
                    <h2 class="footer-wid-title">Categories</h2>
                    <ul>
                        <li><a href="#">Mobile Phone</a></li>
                        <li><a href="#">Home accesseries</a></li>
                        <li><a href="#">LED TV</a></li>
                        <li><a href="#">Computer</a></li>
                        <li><a href="#">Gadets</a></li>
                    </ul>
                </div>
            </div>

            <div class="col-md-3 col-sm-6">
                <div class="footer-newsletter">
                    <h2 class="footer-wid-title">Newsletter</h2>
                    <p>Sign up to our newsletter and get exclusive deals you wont find anywhere else straight to your inbox!</p>
                    <div class="newsletter-form">
                        <form action="#">
                            <input type="email" placeholder="Type your email">
                            <input type="submit" value="Subscribe">
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> <!-- End footer top area -->

<div class="footer-bottom-area">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="copyright">
                    <p>&copy; 2015 uCommerce. All Rights Reserved. <a href="http://www.freshdesignweb.com" target="_blank">freshDesignweb.com</a></p>
                </div>
            </div>

            <div class="col-md-4">
                <div class="footer-card-icon">
                    <i class="fa fa-cc-discover"></i>
                    <i class="fa fa-cc-mastercard"></i>
                    <i class="fa fa-cc-paypal"></i>
                    <i class="fa fa-cc-visa"></i>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /.content -->
<div class="modal center-modal fade" id="modal-center" tabindex="-1" style="display: none;" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Xóa sản Phẩm</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="ma1" />
                <p>Bạn có muốn xóa khỏi giỏ hàng</p>
            </div>
            <div class="modal-footer modal-footer-uniform">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Không </button>
                <button type="button" class="btn btn-primary float-right" data-dismiss="modal" id="xoa1">Có</button>
            </div>
        </div>
    </div>
</div>

@section css{
    <link href="~/soucreClients/css/font-awesome.min.css" rel="stylesheet" />
    <link href="~/assets/vendor_components/jquery-toast-plugin-master/src/jquery.toast.css" rel="stylesheet" />

}
@section script{
    <script src="~/Scripts/bootstrap.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/assets/vendor_components/jquery-toast-plugin-master/src/jquery.toast.js"></script>
    <script>
        $(document).ready(function () {
            load();
            loadSP();
            $('body').on('click', '.btndelete', function () {
                var maSP = $(this).data('id');
                $('#ma1').val(maSP);
            })
            $("#xoa1").on("click", function () {
                var maSP = $('#ma1').val();
                var discount = $('#discountSelect').val();
                $.ajax({
                    url: "/sanPham/xoaSP",
                    type: "POST",
                    data: { maSP: maSP },
                    success: function (res) {
                        if (res.success) {
                            $.toast({
                                heading: 'Thành Công  ',
                                text: ' Xóa Sản Phẩm  ',
                                position: 'top-right',
                                loaderBg: '#ff6849',
                                icon: 'success',
                                hideAfter: 1500,
                                stack: 6,
                                afterShown: function () { load(); },
                            });
                            $('#modal-center').modal('hide');
                            discount1(discount, res.tongtien)
                        }

                    }
                })

            })
            $('body').on('click', '.btnupdate', function () {
                var maSP = $(this).data('id');
                var soLuong = $('#soLuong_' + maSP).val();
                update(maSP, soLuong);
            })
            $('body').on('click', '.btnxoaSP', function () {
                var maSP = $(this).data('id');
                $.ajax({
                    url: "/sanPham/xoaSP",
                    type: "POST",
                    data: { maSP: maSP },
                    success: function (res) {
                        if (res.success) {
                            $.toast({
                                heading: 'Thành Công  ',
                                text: ' Xóa Sản Phẩm  ',
                                position: 'top-right',
                                loaderBg: '#ff6849',
                                icon: 'success',
                                hideAfter: 1500,
                                stack: 6,
                            });
                        }

                    }
                })
            })
            $('body').on('click','#dat1', function () {
                var tableData = [];
                $("#muaHang1 tr").each(function () {
                    var rowData = {
                        maSP: $(this).find(".btnupdate").data('id'),
                        soLuong: $(this).find(".btnsoLuong").val(),
                    };
                    tableData.push(rowData);
                });
                $.ajax({
                    url: '/sanPham/thongTinDon',
                    type: 'POST',
                    data: { lst: tableData, __RequestVerificationToken: $('input[name=__RequestVerificationToken]').val() },
                    success: function (res) {
                        if (res.success) {
                            window.location.href = "/sanPham/checkOut"
                        }
                        else {
                            $.toast({
                                heading: 'Bạn không có đơn để đặt mua',
                                text: 'Vào Shop để chọn sản phẩm phù hợp',
                                position: 'top-right',
                                loaderBg: '#ff6849',
                                icon: 'warning',
                                hideAfter: 3500,
                                stack: 6,

                            });
                        }

                    }

                })
            })
            $('body').on('click', '.btndetail1', function () {
                var maSP = $(this).data("id");
                $.ajax({
                    url: "/sanPham/getID",
                    type: "POST",
                    data: { maSP: maSP, __RequestVerificationToken: $('input[name=__RequestVerificationToken]').val() },
                    success: function (res) {
                        if (res.success) {
                            window.location.href = '/sanPham/detail';
                        }
                    }
                })
            })
            $('body').on('input', '#check', function () {
                var check = $('#check').val();
                if (check != '') {
                    $('#load_payment').show();
                    $('#gui1').hide();
                    $.ajax({
                        url: "/sanPham/timKiemSP",
                        type: "POST",
                        data: { timKiem: check },
                        success: function (res) {
                            if (res.success) {
                                var html = "";
                                var items = res.data;
                                for (i = 0; i < items.length; i++) {
                                    html += "<div class='thubmnail-recent'>";
                                    html += "<img src='/images/product/" + items[i].hinhAnh + "' class='recent-thumb' alt=''>";
                                    html += " <h2><a href='' data-id='" + items[i].maSP + "' class='btndetail1'>" + items[i].tenSP + "</a></h2>";
                                    html += " <div class='product-sidebar-price'>";
                                    html += "<ins>" + items[i].giaBan + "0000VND</ins><span style='color:red'>-" + items[i].maGiam + "%</span>";
                                    html += "</div>";
                                    html += "</div>";
                                }
                                $('#load_payment').html(html);
                            }
                            else {
                                $('#load_payment').html("Không tìm thấy sản phẩm");
                            }
                        }
                    })
                } else {
                    $('#load_payment').hide();
                    $('#gui1').show();
                }
            })

        })
        function load() {
            $.ajax({
                url: "/sanPham/load",
                type: "POST",
                success: function (res) {
                    var items = res.data;
                    var html = "";
                    if (res.count > 0) {
                        for (let i = 0; i < res.count; i++) {
                            html+="<tr>"
                            html += "<td><img src='/images/product/" + items[i].hinhAnh + "' alt='' width='80'></td>"
                            html += "<td> <h5>" + items[i].tenSP + "</h5></td>"
                            html += "<td> " + (items[i].giaBan * 1000).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }) + " </td>"
                            html += "<td width='70'><input type='number'  class='form-control  btnsoLuong '   id='soLuong_" + items[i].maSP + "' value='" + items[i].soLuong + "' min='0'></td>"
                            html += "<td>" + items[i].giamGia + "%</td>"
                            html += "<td width='100' align='center' class='font-weight-900'><span id='tongTien'>" + (items[i].thanhTien * 1000).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }) + " </td>"
                            html += "<td align='center'><a href='#' class='text-info mr-10 btnupdate' data-id='" + items[i].maSP + "' data-toggle='tooltip' data-original-title='Edit'><i class='ti-marker-alt'></i>sửa</a><a href='#' class='text-danger btndelete' title='' data-toggle='modal' data-target='#modal-center' data-id='" + items[i].maSP + "'  data-toggle='tooltip' data-original-title='Delete'>Xóa</a></td>"
                            html+="</tr>"
                        }
                        $('#thanhTien1').text((res.tongtien * 1000).toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }));
                        $('#tongTien').text(res.tongtien);
                        $('#muaHang1').html(html);
                    }
                    else if (res.count == 0) {
                        $('#muaHang1').html("");
                        $('#tongtien').text("0");
                        $('#finalPrice').text("0");
                        $('#tongSL').text("0");
                    }

                }
            })
        }
        function update(maSP, soLuong) {
            $.ajax({
                url: "/sanPham/update",
                type: "POST",
                data: { maSP: maSP, soLuong: soLuong },
                success: function (res) {
                    if (res.success) {
                        $.toast({
                            heading: ' Thành Công ',
                            text: ' Sửa Thành Công  ',
                            position: 'top-right',
                            loaderBg: '#ff6849',
                            icon: 'success',
                            hideAfter: 1500,
                            stack: 6,
                        });
                        load();

                    }
                }
            })
        }
        function loadSP() {
            $.ajax({
                url: "/sanPham/loadSP",
                type: "POST",
                success: function (res) {
                    if (res.success) {
                        var html = "";
                        var items = res.data;
                        for (i = 0; i < items.length; i++) {
                            html += "<div class='thubmnail-recent'>";
                            html += "<img src='/images/product/" + items[i].hinhAnh + "' class='recent-thumb' alt=''>";
                            html += "<h2><a href=''data-id='" + items[i].maSP + "' class='btndetail1'>" + items[i].tenSP + "</a></h2>";
                            html += " <div class='product-sidebar-price'>";
                            html += "<ins>" + items[i].giaBan.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' }) + "</ins><span style='color:red'>-" + items[i].maGiam + "%</span>";
                            html += "</div>";
                            html += "</div>";
                        }
                        $('#sP1').html(html);
                    }
                }
            })
        }
    </script>
}

